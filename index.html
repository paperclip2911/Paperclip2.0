<script>
let user=""
let clips=0, autos=0, autoCost=50, megas=0, megaCost=500, rebirthMult=1
let productionBoost=1
let achievements=[]
let leaderboard=JSON.parse(localStorage.getItem("leaderboard"))||[]

/* SAVE SYSTEM */
function save(){
localStorage.setItem("paper_"+user,JSON.stringify({
clips,autos,autoCost,megas,megaCost,rebirthMult,productionBoost,achievements
}))
}
function load(){
let data=JSON.parse(localStorage.getItem("paper_"+user))
if(data){
clips=data.clips
autos=data.autos
autoCost=data.autoCost
megas=data.megas
megaCost=data.megaCost
rebirthMult=data.rebirthMult
productionBoost=data.productionBoost||1
achievements=data.achievements||[]
}
}
function login(){
user=username.value
if(!user)return
load()
loginScreen.style.display="none"
game.style.display="block"
update()
}

/* UPDATE LOOP */
function update(){
clips=Math.floor(clips)
clipsSpan=document.getElementById("clips")
if(clipsSpan) clipsSpan.innerText=clips
casinoClips.innerText=clips
document.getElementById("autos").innerText=autos
document.getElementById("megas").innerText=megas
document.getElementById("autoCost").innerText=autoCost
document.getElementById("megaCost").innerText=megaCost
document.getElementById("perSecond").innerText=
(autos+megas*10)*rebirthMult*productionBoost
document.getElementById("rebirthMult").innerText=rebirthMult
checkAchievements()
save()
}
setInterval(()=>{
clips+=(autos+megas*10)*rebirthMult*productionBoost
update()
},1000)

/* ACHIEVEMENTS */
function checkAchievements(){
if(clips>=1000 && !achievements.includes("1k")){
achievements.push("1k")
alert("Achievement: 1,000 Clips!")
}
if(rebirthMult>=3 && !achievements.includes("rebirth3")){
achievements.push("rebirth3")
alert("Achievement: 3 Rebirths!")
}
}

/* LEADERBOARD */
function updateLeaderboard(){
leaderboard.push({user,score:clips})
leaderboard.sort((a,b)=>b.score-a.score)
leaderboard=leaderboard.slice(0,5)
localStorage.setItem("leaderboard",JSON.stringify(leaderboard))
}

/* CLICKER */
function clickClip(){clips+=1*rebirthMult*productionBoost;update()}
function buyAuto(){if(clips>=autoCost){clips-=autoCost;autos++;autoCost=Math.floor(autoCost*1.25);update()}}
function buyMega(){if(clips>=megaCost){clips-=megaCost;megas++;megaCost=Math.floor(megaCost*1.4);update()}}
function rebirth(){
if(clips>=1000000){
updateLeaderboard()
clips=0;autos=0;megas=0;autoCost=50;megaCost=500
rebirthMult++;update()
}
}

/* CASINO PERK */
function grantPerk(){
productionBoost*=1.2
alert("Casino Perk! Production Boosted 20%!")
}

/* BLACKJACK ADVANCED */
let deck=[],player=[],dealer=[],splitHand=[]
let bjActive=false,currentBet=0,doubled=false,splitMode=false

function createDeck(){
let suits=["♠","♥","♦","♣"]
let ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"]
deck=[]
for(let s of suits){for(let r of ranks){deck.push({rank:r,suit:s})}}
deck.sort(()=>Math.random()-0.5)
}

function value(c){
if(c.rank==="A") return 11
if(["K","Q","J"].includes(c.rank)) return 10
return parseInt(c.rank)
}

function total(hand){
let t=0, aces=0
for(let c of hand){t+=value(c);if(c.rank==="A")aces++}
while(t>21&&aces>0){t-=10;aces--}
return t
}

function renderBJ(hideDealer=false){
playerCards.innerHTML=""
dealerCards.innerHTML=""
player.forEach(c=>playerCards.innerHTML+=
`<div class="card">${c.rank}${c.suit}</div>`)

dealer.forEach((c,i)=>{
if(hideDealer && i===1){
dealerCards.innerHTML+=`<div class="card">?</div>`
}else{
dealerCards.innerHTML+=`<div class="card">${c.rank}${c.suit}</div>`
}
})
playerTotal.innerText=total(player)
dealerTotal.innerText=hideDealer?"?":total(dealer)
update()
}

function startBJ(){
let bet=parseInt(bjBet.value)
if(bet>clips||bet<=0)return
createDeck()
player=[deck.pop(),deck.pop()]
dealer=[deck.pop(),deck.pop()]
clips-=bet
currentBet=bet
bjActive=true
doubled=false
splitMode=false
bjResult.innerText=""
renderBJ(true)
}

function hit(){
if(!bjActive)return
player.push(deck.pop())
renderBJ(true)
if(total(player)>21){bjResult.innerText="Bust!";bjActive=false}
}

function stand(){
if(!bjActive)return
while(total(dealer)<17){dealer.push(deck.pop())}
let p=total(player), d=total(dealer)
renderBJ(false)
if(d>21||p>d){clips+=currentBet*2;bjResult.innerText="Win!";grantPerk()}
else if(p===d){clips+=currentBet;bjResult.innerText="Push"}
else bjResult.innerText="Dealer Wins"
bjActive=false
}

function doubleDown(){
if(!bjActive||doubled)return
if(clips<currentBet)return
clips-=currentBet
currentBet*=2
doubled=true
player.push(deck.pop())
renderBJ(true)
if(total(player)>21){bjResult.innerText="Bust after Double!";bjActive=false;return}
stand()
}

function split(){
if(!bjActive)return
if(player.length===2 && value(player[0])===value(player[1])){
splitMode=true
splitHand=[player.pop()]
alert("Split activated (basic version)")
}
}
</script>
